<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Login</title>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        const firebaseConfig = {
          apiKey: "key..............",
          authDomain: "alert-cursor-476219-s1.firebaseapp.com",
          projectId: "alert-cursor-476219-s1",
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        async function doLogin() {
          const email = document.getElementById("email").value;
          const pass  = document.getElementById("password").value;
          const msg   = document.getElementById("msg");

          msg.innerText = "Logging in...";

          try {
            // Firebase authentication
            const userCred = await signInWithEmailAndPassword(auth, email, pass);

            // Get Firebase ID Token
            const idToken = await userCred.user.getIdToken();

            // Send to your backend
            const resp = await fetch("/api/hello", {
              method: "GET",
              headers: {
                "Authorization": "Bearer " + idToken
              }
            });

            if (resp.ok) {
              msg.innerText = "Login successful!";
            } else {
              msg.innerText = "Backend rejected token!";
            }

          } catch (e) {
            msg.innerText = "Error: " + e.message;
          }
        }

        window.doLogin = doLogin;
    </script>
</head>

<body>
<h2>Login</h2>

<div>
    <label>Email</label><br/>
    <input id="email" type="email" /><br/><br/>

    <label>Password</label><br/>
    <input id="password" type="password" /><br/><br/>

    <button onclick="doLogin()">Login</button>

    <p id="msg" style="color: red; font-weight: bold;"></p>
</div>
</body>
</html>
